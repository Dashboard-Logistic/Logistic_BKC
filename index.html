function doGet() {
  return HtmlService.createTemplateFromFile('index').evaluate()
  .setTitle("Dashboard Logistic")
  .setFaviconUrl("https://img2.pic.in.th/pic/LOgistic.png")
  .addMetaTag('viewport', 'width=device-width, initial-scale=1')
  .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL)
}

/** @Get URL */
function getURL() {
  return ScriptApp.getService().getUrl();
}

/**à¸”à¸¶à¸‡à¹„à¸Ÿà¸¥à¹Œ */
function include(filename){
  return HtmlService.createHtmlOutputFromFile(filename).getContent()
}

function getData(sh) {
  return ss = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sh).getDataRange().getDisplayValues().slice(2)
}

function getDataApp(sh) {
  return ss = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sh).getDataRange().getDisplayValues().slice(1).filter(r=>r[1]=="à¸£à¸­à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´")
}

function saveData(cart,fname,dpm) {
  var bookno = uuid()
  var pad = "00000"; //à¸ˆà¸³à¸™à¸§à¸™à¸«à¸¥à¸±à¸à¸—à¸µà¹ˆà¸„à¸²à¸”à¸§à¹ˆà¸²à¸¡à¸µà¸„à¸™à¹€à¸‚à¹‰à¸²à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
  var runid = pad.substring(0, pad.length - bookno.length) + bookno;
  const date = new Date()
  const result = date.toLocaleDateString('th-TH', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
})
 const ss = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('LogProduct');
 var msg = "à¹à¸ˆà¹‰à¸‡à¸œà¸¥à¸£à¸²à¸¢à¸à¸²à¸£à¸‚à¸­à¹€à¸šà¸´à¸à¸§à¸±à¸ªà¸”à¸¸à¸ªà¸³à¸™à¸±à¸à¸‡à¸²à¸™" + 
            "\nðŸ“ à¹€à¸¥à¸‚à¸—à¸µà¹ˆ : " +"JP67/"+runid+
            "\nðŸ“ à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥ : " + fname +
            "\nðŸ“ à¸«à¸™à¹ˆà¸§à¸¢à¸‡à¸²à¸™ : " + dpm +
            "\n"
  cart.forEach(r => {
    ss.appendRow([
      "",
      "à¸£à¸­à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´",
      result,
      "JP67/"+runid,
      fname,
      dpm,
      "'"+r.id,
      r.name,
      r.unix,
      r.count,      
    ]);
  msg = msg + "\nðŸ“ à¸£à¸«à¸±à¸ªà¸§à¸±à¸ªà¸”à¸¸ : " + r.id + " \nðŸ“ à¸£à¸²à¸¢à¸à¸²à¸£ : " + r.name +  " à¸ˆà¸³à¸™à¸§à¸™ " + r.count+ " " + r.unix 
  })
  var token = tokenID
  sendNotify(msg,token)
}


function toGoogleSheets(obj){
   const ss = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Product');
  var data = ss.getDataRange().getValues();
  var indexName = data.map(d => d[0]);
  var position = indexName.indexOf(obj.data1);
  if(position > -1){ 
    ss.getRange(position+1,5).setValue(obj.data2); 
  }
  return true;
}

function saveEditApp(id){
var ss = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('LogProduct') //change
var data = ss.getDataRange().getDisplayValues()
 let rowID = data.findIndex(r =>r[0]==id)+1
  if(rowID >1){
    ss.getRange(rowID,2).setValue('à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´')
  }
 }

 function saveEditApp2(id) {
  var ss = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("LogProduct")
  let data = ss.getDataRange().getDisplayValues()
  let rowID = data.findIndex(r => r[0] == id)+1
  if (rowID > 1) {
    //ss.deleteRow(rowID);
    ss.getRange(rowID,2).setValue('à¹„à¸¡à¹ˆà¸­à¸™à¸¸à¸¡à¸±à¸•à¸´')
    ss.getRange(rowID,10).setValue('0')
  }
}

 function deleteDataApp(id) {
  var ss = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("LogProduct")
  let data = ss.getDataRange().getDisplayValues()
  let rowID = data.findIndex(r => r[0] == id)+1
  if (rowID > 0) {
    ss.deleteRow(rowID);
  }
  return true;
}
